I"†Ì<h1 id="åˆ†ç±»æ¨¡å‹è¯„ä»·æ–¹æ³•">åˆ†ç±»æ¨¡å‹è¯„ä»·æ–¹æ³•</h1>

<p>è¯„ä¼°åˆ†ç±»å™¨ï¼ˆåˆ†ç±»æ¨¡å‹ï¼‰ç›¸å¯¹äºè¯„ä¼°å›å½’å™¨é€šå¸¸è¦å¤æ‚ï¼Œæœ¬ç¯‡ä»¥MNISTæ•°æ®é›†çš„æ‰‹å†™æ•°å­—è¯†åˆ«åˆ†ç±»ä¸ºä¾‹ï¼Œè®°å½•å¸¸ç”¨çš„åˆ†ç±»å™¨è¯„ä¼°æ–¹æ³•ã€‚</p>

<h2 id="äº¤å‰éªŒè¯cross-validation">äº¤å‰éªŒè¯ï¼šCross-Validation</h2>

<ol>
  <li>
    <p>ç•™ä¸€äº¤å‰éªŒè¯ï¼šï¼ˆLeave-One-Out Cross Validationè®°ä¸ºLOO-CVï¼‰<strong>åœ¨æ•°æ®ç¼ºä¹çš„æƒ…å†µä¸‹ä½¿ç”¨</strong>ï¼Œå¦‚æœè®¾åŸå§‹æ•°æ®æœ‰Nä¸ªæ ·æœ¬ï¼Œé‚£ä¹ˆLOO-CVå°±æ˜¯N-CVï¼Œå³æ¯ä¸ªæ ·æœ¬å•ç‹¬ä½œä¸ºéªŒè¯é›†ï¼Œå…¶ä½™çš„N-1ä¸ªæ ·æœ¬ä½œä¸ºè®­ç»ƒé›†ï¼Œæ•…LOO-CVä¼šå¾—åˆ°Nä¸ªæ¨¡å‹ï¼Œç”¨è¿™Nä¸ªæ¨¡å‹æœ€ç»ˆçš„éªŒè¯é›†çš„åˆ†ç±»å‡†ç¡®ç‡çš„å¹³å‡æ•°ä½œä¸ºæ­¤ä¸‹LOO-CVåˆ†ç±»å™¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚</p>
  </li>
  <li>
    <p>kæŠ˜äº¤å‰éªŒè¯ï¼šå°†åŸå§‹æ•°æ®åˆ†æˆKç»„ï¼ˆä¸€èˆ¬æ˜¯å‡åˆ†ï¼‰ï¼Œå°†æ¯ä¸ªå­é›†æ•°æ®åˆ†åˆ«åšä¸€æ¬¡éªŒè¯é›†ï¼Œå…¶ä½™çš„K-1ç»„å­é›†æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œè¿™æ ·ä¼šå¾—åˆ°Kä¸ªæ¨¡å‹ï¼Œç”¨è¿™Kä¸ªæ¨¡å‹æœ€ç»ˆçš„éªŒè¯é›†çš„åˆ†ç±»å‡†ç¡®ç‡çš„å¹³å‡æ•°ä½œä¸ºæ­¤K-CVä¸‹åˆ†ç±»å™¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚Kä¸€èˆ¬å¤§äºç­‰äº2ï¼Œå®é™…æ“ä½œæ—¶ä¸€èˆ¬ä»3å¼€å§‹å–ï¼Œåªæœ‰åœ¨åŸå§‹æ•°æ®é›†åˆæ•°æ®é‡å°çš„æ—¶å€™æ‰ä¼šå°è¯•å–2ã€‚
<img src="https://img-blog.csdnimg.cn/f615e5826103441289399c5bc24ae0cf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="" /></p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#KæŠ˜äº¤å‰éªŒè¯
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">log_reg</span><span class="p">,</span> <span class="n">X_pca_3</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s">'accuracy'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>  
<span class="k">print</span><span class="p">(</span><span class="s">"5æŠ˜äº¤å‰éªŒè¯å¹³å‡å‡†ç¡®ç‡ï¼š"</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</code></pre></div></div>

<p>äº¤å‰éªŒè¯çš„å±€é™åœ¨äºé¢å¯¹æ ·æœ¬åˆ†å¸ƒæä¸å‡åŒ€çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚åˆ†ç±»æ­£ä¾‹åä¾‹æ—¶ï¼Œæ ·æœ¬ä¸­æ­£ä¾‹æ•°ç›®æå¤šï¼Œé‚£ä¹ˆåˆ†ç±»æ­£ä¾‹çš„æˆåŠŸæ¦‚ç‡è‡ªç„¶ä¼šå¾ˆé«˜ï¼Œå¦‚æ­¤å¾—åˆ°äº¤å‰éªŒè¯çš„é«˜å‡†ç¡®æ€§å¯ä¿¡åº¦è¾ƒä½ã€‚</p>

<h2 id="æ··æ·†çŸ©é˜µconfusion-matrix">æ··æ·†çŸ©é˜µï¼šConfusion Matrix</h2>
<p>è€ƒè™‘æœ€ç®€å•çš„äºŒåˆ†ç±»æƒ…å†µï¼Œåˆ†ç±»å‡ºé”™çš„å¯èƒ½æœ‰FPï¼ˆå‡æ­£ä¾‹ï¼ŒåŸæœ¬æ˜¯åä¾‹ï¼Œè¯¯åˆ†ç±»ä¸ºæ­£ä¾‹ï¼‰ï¼ŒFNï¼ˆå‡åä¾‹ï¼ŒåŸæœ¬æ˜¯æ­£ä¾‹ï¼Œè¯¯åˆ†ç±»ä¸ºåä¾‹ï¼‰ã€‚
<img src="https://img-blog.csdnimg.cn/6d14071004264f7d8bd1656c09977a39.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">y_pre</span><span class="o">=</span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">confusion</span><span class="o">=</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pre</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">Blues</span><span class="p">)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="n">classes</span><span class="p">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">confusion</span><span class="p">))</span>
    <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">([[[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">],(</span><span class="n">confusion</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">iters</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">confusion</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>   <span class="c1">#æ˜¾ç¤ºå¯¹åº”çš„æ•°å­—
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Confusion matrix of %s "</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
    <span class="c1"># plt.ylim(len(confusion)-0.5,-0.5)
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'prediction'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'reality'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">log_reg</span><span class="p">,</span><span class="s">'LogistRegression'</span><span class="p">)</span><span class="err">`</span>
</code></pre></div></div>
<p><img src="https://img-blog.csdnimg.cn/776706a8c1e743e088b31cc1ce117aa6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />æ··æ·†çŸ©é˜µæ²¿ç€ä¸»å¯¹è§’çº¿çš„åˆ†å¸ƒé›†ä¸­åº¦è¶Šé«˜ï¼Œä»£è¡¨æ¨¡å‹çš„åˆ†ç±»ç²¾åº¦è¶Šé«˜ã€‚</p>

<h2 id="ç²¾ç¡®ç‡å¬å›ç‡æŸ¥å‡†ç‡æŸ¥å…¨ç‡precision-and-recall">ç²¾ç¡®ç‡&amp;å¬å›ç‡ï¼ˆæŸ¥å‡†ç‡&amp;æŸ¥å…¨ç‡ï¼‰ï¼šPrecision and Recall</h2>

\[P = TP/(TP+FP)\]

<p>ç²¾ç¡®ç‡é’ˆå¯¹é¢„æµ‹ç»“æœè€Œè¨€ï¼Œåˆç§°æŸ¥å‡†ç‡ï¼Œå³é¢„æµ‹ç»“æœä¸­é¢„æµ‹æ­£ç¡®çš„æ­£æ ·æœ¬æ‰€å æ€»é¢„æµ‹æ¬¡æ•°çš„æ¯”ç‡ï¼Œè¯¥å€¼è¶Šå¤§è¯æ˜é¢„æµ‹ç»“æœçš„å‡†ç¡®ç‡è¶Šé«˜
\(R = TP/(TP+FN)\)
å¬å›ç‡é’ˆå¯¹åŸæœ‰æ ·æœ¬è€Œè¨€ï¼ŒåˆæˆæŸ¥å…¨ç‡ï¼Œå³é¢„æµ‹æ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ­£æ ·æœ¬å æ€»çš„çœŸå®æ ·æœ¬çš„æ¯”ç‡ï¼Œè¯¥å€¼è¶Šå¤§è¯æ˜é¢„æµ‹ç»“æœä¸­é¢„æµ‹åˆ°çš„æ­£ä¾‹æ•°ç›¸å¯¹äºæ ·æœ¬ä¸­å®é™…çš„æ­£ä¾‹æ•°è¶Šå…¨ã€‚æ‰€è°“å¬å›ï¼Œå¯ç†è§£ä¸ºçœŸå®çš„æ­£ä¾‹æ•°åœ¨é¢„æµ‹ä¸­å†æ¬¡é¢„æµ‹å‡ºï¼Œå³è¢«å¬å›ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/6d14071004264f7d8bd1656c09977a39.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<ul>
  <li>ç²¾ç¡®ç‡/å¬å›ç‡æƒè¡¡ ï¼šPrecision/Recall Tradeoff
ç²¾ç¡®ç‡ä¸å¬å›ç‡é€šå¸¸æ— æ³•åŒæ—¶å–å¾—æ¯”è¾ƒç†æƒ³çš„ç»“æœï¼Œè€ƒè™‘å®é™…ä¸­æ¨¡å‹5åˆ†ç±»å™¨é¢„æµ‹çš„è¿‡ç¨‹ï¼Œæ¨¡å‹é€šè¿‡è®­ç»ƒæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªåˆ¤æ–­çš„é˜ˆå€¼thresholdï¼Œé«˜äºthresholdåˆ¤æ–­ä¸º5ï¼Œåä¹‹ä¸ºé5ï¼Œæ˜¾è€Œæ˜“è§çš„æ—¶ï¼Œå½“é«˜é˜ˆå€¼çš„æƒ…å†µä¸‹ç²¾ç¡®æ€§æ›´é«˜ï¼Œè€Œä½é˜ˆå€¼çš„æƒ…å†µä¸‹å¬å›ç‡æ›´é«˜ï¼Œå³åˆ†ç±»æ¨¡å‹å¯å›Šæ‹¬çš„çœŸå®æ­£å®ä¾‹5çš„æ•°ç›®è¶Šå¤šã€‚
<img src="https://img-blog.csdnimg.cn/29d7982c2b8b4d3f9e5d7efc10fd64d1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></li>
</ul>

<p><img src="https://img-blog.csdnimg.cn/515eddacff7547eab9125db1c68356bc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="" />
é«˜ç²¾ç¡®ç‡å’Œé«˜å¬å›ç‡çš„å–èˆé€šå¸¸å–å†³äºæˆ‘ä»¬éœ€è¦è§£å†³çš„å®é™…é—®é¢˜ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦è®­ç»ƒä¸€ä¸ªè§†é¢‘åˆ†ç±»å™¨ï¼Œä»¥é¿å…å°†ä¸å¥½çš„å†…å®¹æ¨é€ç»™ç”¨æˆ·æ—¶ï¼Œå‡å¦‚è¿™é‡Œçš„5ä»£è¡¨å¥åº·çš„è§†é¢‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å€¾å‘äºæ¨¡å‹å…·æœ‰æ›´é«˜çš„å‡†ç¡®æ€§ï¼Œä»¥ä¿è¯æ¨é€ç»™ç”¨æˆ·çš„è§†é¢‘å°½å¯èƒ½çš„å¥åº·ï¼Œå°½ç®¡è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´å¬å›ç‡çš„ä¸‹é™ï¼Œå³å°†ä¸€äº›åŸæœ¬å¥åº·çš„è§†é¢‘åˆ†åˆ°é—®é¢˜è§†é¢‘çš„ç±»åˆ«ä¸­ï¼›åœ¨å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œè€ƒè™‘æœºåœºè§†é¢‘ç›‘æ§ä¸­å¯ç–‘æ‰’æ‰‹è¯†åˆ«æ¨¡å‹ä¸­ï¼Œå‡å¦‚è¿™é‡Œçš„5ä»£è¡¨å·çªƒè¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬æ›´å€¾å‘äºæ¨¡å‹èƒ½å¤Ÿå…·æœ‰æ›´é«˜çš„å¬å›ç‡ï¼Œä»¥å°½å¯èƒ½åœ°ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªæ‰’æ‰‹ï¼Œå°½ç®¡è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹å‡†ç¡®æ€§ä¸‹é™ï¼Œä»¥è‡³äºé”™è¯¯è­¦æŠ¥å¢å¤šã€‚
	å‡†ç¡®ç‡ä¸å¬å›ç‡çš„æƒè¡¡ä¹Ÿå¯èƒ½é€šè¿‡ç»˜åˆ¶ä»¥å‡†ç¡®ç‡å’Œå¬å›ç‡ä¸ºåæ ‡è½´çš„å›¾åƒæ›²çº¿æ¥çœ‹ï¼Œé€šå¸¸ç§°ä¸ºPRæ›²çº¿ï¼š
	<img src="https://img-blog.csdnimg.cn/ec836e78d3a446308185170f45f89b5c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />
é€šè¿‡è¯¥å›¾ï¼Œç»“åˆè‡ªå·±çš„å®é™…æƒ…å†µï¼Œå¯ä»¥åœ¨ç¡®ä¿ç²¾ç¡®ç‡æˆ–è€…å¬å›ç‡ä¸€æ–¹è¾¾åˆ°è¦æ±‚çš„åŒæ—¶ï¼Œä»…å¯èƒ½é€‰æ‹©å¦ä¸€å‚æ•°æ›´é«˜çš„é˜ˆå€¼ï¼Œæ¥å¾—åˆ°ç¬¦åˆæœŸæœ›çš„æ¨¡å‹æ•ˆæœã€‚</p>

<p>æ­¤å¤–ï¼Œå½“æ¨¡å‹çš„å‡†ç¡®ç‡å’Œå¬å›ç‡ç›¸è¿‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‡†ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°ï¼Œé€šå¸¸ç§°ä¸ºF1å¾—åˆ†ï¼Œæ¥è¯„ä»·æ¨¡å‹åˆ†æ•°</p>

\[F_{1}=\frac{2}{\frac{1}{\text { precision }}+\frac{1}{\text { recall }}}=2 \times \frac{\text { precision } \times \text { recall }}{\text { precision }+\text { recall }}=\frac{T P}{T P+\frac{F N+F P}{2}}\]

<h2 id="å—è¯•è€…å·¥ä½œç‰¹å¾æ›²çº¿receiver--operating--characteristic--roc--curve">å—è¯•è€…å·¥ä½œç‰¹å¾æ›²çº¿ï¼šreceiver  operating  characteristic  (ROC)  curve</h2>

<p>å¾—æ­¤åçš„åŸå› åœ¨äºæ›²çº¿ä¸Šå„ç‚¹åæ˜ ç€ç›¸åŒçš„æ„Ÿå—æ€§ï¼Œå®ƒä»¬éƒ½æ˜¯å¯¹åŒä¸€ä¿¡å·åˆºæ¿€çš„ååº”ï¼Œåªä¸è¿‡æ˜¯åœ¨å‡ ç§ä¸åŒçš„åˆ¤å®šæ ‡å‡†ä¸‹æ‰€å¾—çš„ç»“æœè€Œå·²ã€‚
å®ƒä¸ç²¾ç¡®ç‡/å¬å›ç‡æ›²çº¿éå¸¸ç›¸ä¼¼ï¼Œä½† ROC æ›²çº¿ä¸æ˜¯ç»˜åˆ¶ç²¾ç¡®ç‡ä¸å¬å›ç‡çš„å…³ç³»å›¾ï¼Œè€Œæ˜¯ç»˜åˆ¶çœŸé˜³æ€§ç‡ï¼ˆå¬å›çš„å¦ä¸€ä¸ªåç§°ï¼‰ä¸å‡é˜³æ€§ç‡çš„å…³ç³»å›¾ã€‚æ‰€è°“çœŸé˜³æ€§ç‡å³ä¸ºå¬å›ç‡ï¼Œè€Œå‡é˜³æ€§ç‡(false positive rate)ï¼Œå³çœŸå®ä¸ºé˜´æ€§çš„è¢«è¯¯è®¤ä¸ºæ˜¯é˜³æ€§çš„æ ·æœ¬å åŸæœ‰æ ·æœ¬çš„æ¯”ç‡ï¼Œå®ƒç­‰ä»·äº1-çœŸé˜´æ€§ç‡ï¼ŒçœŸé˜´æ€§ç‡å³çœŸå®ä¸ºé˜´æ€§ä¸”é¢„æµ‹ä¸ºé˜´æ€§æ‰€åœ¨é¢„æµ‹æ ·æœ¬ä¸­çš„æ¯”ç‡ï¼ŒçœŸé˜´æ€§ç‡å¯ä»¥ç§°ä¸ºä»¥é˜´æ€§ä¸ºä¸»çš„å‡†ç¡®ç‡ã€‚</p>

\[TPR = TP/(TP+FN)\]

\[FPR = FP/(FP+TN) = 1-TNR\]

\[TNR = TN/(TN+FP)\]

<p><img src="https://img-blog.csdnimg.cn/e96a073c5ed2414f96ba09e78cf9445a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6Iq45YWu,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />
FPRå’ŒTPRæ›²çº¿åŒæ ·å…·æœ‰ç±»ä¼¼å‡†ç¡®ç‡å’Œå¬å›ç‡é‚£æ ·çš„æƒè¡¡ï¼Œä¸Šå›¾è™šçº¿ä»£è¡¨éšæœºåˆ†ç±»å™¨çš„ç»“æœï¼Œä¸€ä¸ªå¥½çš„åˆ†ç±»å™¨ä¼šå°½å¯èƒ½çš„è¿œç¦»è¯¥è™šçº¿ã€‚
ä¸€ç§æ¯”è¾ƒåˆ†ç±»å™¨å¥½åçš„æ–¹æ³•æ˜¯æ¯”è¾ƒROCæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ï¼ˆArea Under the Curveï¼‰ï¼Œé¢ç§¯æ¥è¿‘ä¸º1çš„åˆ†ç±»å™¨æ˜¯æœ€ä¸ºç†æƒ³çš„ã€‚
	ROCæ›²çº¿å’ŒPRæ›²çº¿æ˜¯ååˆ†ç±»ä¼¼çš„ï¼Œç»éªŒæ³•åˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“æ ·æœ¬ä¸­é˜³æ€§ä¾‹æ•°ç›®è¾ƒå°‘ï¼Œæˆ–è€…æˆ‘ä»¬æ›´åŠ å…³å¿ƒå‡é˜³æ€§ï¼ˆå‡é˜³æ€§ä¸ºå°æ¦‚ç‡ï¼‰æ—¶ï¼Œé€‰æ‹©PRæ›²çº¿ï¼Œåä¹‹é€‰æ‹©ROCæ›²çº¿ã€‚</p>

<p>æœ€åè´´ä¸€ä¸ªMNISTæ•°æ®é›†ä½¿ç”¨sgdåˆ†ç±»æ‰‹å†™æ•°å­—æ˜¯å¦ä¸º5çš„äºŒåˆ†ç±»å™¨çš„è®­ç»ƒåŠè¯„ä»·å…¨æµç¨‹ä»£ç </p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span><span class="s">"""
Created on Tue Oct  5 19:17:58 2021

@author: Flower unbeaten
"""</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">assert</span> <span class="n">sys</span><span class="p">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1">#Scikit-Learn â‰¥0.20 is required
</span><span class="kn">import</span> <span class="nn">sklearn</span>
<span class="k">assert</span> <span class="n">sklearn</span><span class="p">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="s">"0.20"</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1">#plot pretty figures
#å¼•å…¥ç”»å›¾åº“ï¼Œæå‰è®¾ç½®å¥½ç»˜å›¾åæ ‡æ ‡ç­¾å¤§å°ç­‰å‚æ•°
</span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'font.family'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'SimHei'</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'axes.unicode_minus'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span><span class="c1">#ç»˜å›¾å‡†å¤‡
</span><span class="n">mpl</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'axes'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">mpl</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'xtick'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">mpl</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'ytick'</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1">#figures save path
#é™æ€å˜é‡ç»Ÿä¸€ä½¿ç”¨å¤§å†™å­—æ¯+ä¸‹åˆ’çº¿åˆ†å‰²ï¼Œ"."ä»£è¡¨å½“å‰ç›®å½•ï¼Œos.makedirs(â€œä¿å­˜è·¯å¾„â€,exist_ok)
#exist_okä¸ºtrueæ—¶å½“æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨æ—¶ä¸ä¼šæç¤ºå¼‚å¸¸ï¼Œä¸ºfalseæ—¶åˆ™ä¼š
</span><span class="n">PROJECT_ROOT_DIR</span> <span class="o">=</span> <span class="s">"."</span>
<span class="n">CHAPTER_ID</span> <span class="o">=</span> <span class="s">"classification"</span>
<span class="n">IMAGES_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT_DIR</span><span class="p">,</span><span class="s">"images"</span><span class="p">,</span><span class="n">CHAPTER_ID</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">IMAGES_PATH</span><span class="p">,</span><span class="n">exist_ok</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1">#save figure function
</span><span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fig_extension</span><span class="o">=</span><span class="s">"png"</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMAGES_PATH</span><span class="p">,</span> <span class="n">fig_id</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">fig_extension</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Saving figure"</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_extension</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>

<span class="c1">#import MNIST dataset
</span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_openml</span>
<span class="n">mnist</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s">'mnist_784'</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mnist</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1">#overview the data
</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mnist</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span> <span class="p">,</span> <span class="n">mnist</span><span class="p">[</span><span class="s">"target"</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Xå¤§å°ä¸º"</span><span class="p">,</span> <span class="n">X</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"yå¤§å°ä¸º"</span><span class="p">,</span> <span class="n">y</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">#ç±»å‹è½¬åŒ–
#æ•°æ®ç±»å‹åŸæœ¬ä¸ºDataFrameï¼Œè¡¨å¤´ç´¢å¼•å¯¹æ•°æ®è¿›è¡Œè¯´æ˜ï¼Œè¿™é‡Œæˆ‘ä»¬ä»…å…³æ³¨æ•°æ®æœ¬èº«ï¼Œ
#ä½¿ç”¨DataFrameã€Seriesçš„valueså±æ€§è½¬ä¸ºarrayç±»å‹
</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">values</span>

<span class="c1">#å–ä¸€ä¸ªå›¾ç‰‡çœ‹çœ‹
</span><span class="n">some_digit</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">some_digit_image</span> <span class="o">=</span> <span class="n">some_digit</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
<span class="c1">#cmapæŒ‡ä»£colormapï¼ŒæŒ‡å®šä¸ºäºŒå€¼å›¾
</span><span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">some_digit_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>

<span class="c1">#æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ•°å­—å›¾ç‰‡ï¼ŒæŸ¥çœ‹å¯¹åº”çš„targetæ ‡ç­¾
</span><span class="n">save_fig</span><span class="p">(</span><span class="s">"some_digit_plot"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å¯¹åº”çš„æ ‡ç­¾ä¸º"</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_digit</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">"nearest"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
    
<span class="c1">#ç»˜åˆ¶ä¸€ç‰‡æ•°å­—
</span><span class="k">def</span> <span class="nf">plot_digits</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span><span class="n">images_per_row</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">28</span>
    <span class="n">images_per_row</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">),</span><span class="n">images_per_row</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">instance</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">]</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">))</span> <span class="o">//</span> <span class="n">images_per_row</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">row_images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_empty</span> <span class="o">=</span> <span class="n">n_rows</span><span class="o">*</span><span class="n">images_per_row</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
    <span class="n">images</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="o">*</span><span class="n">n_empty</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">rimages</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="n">row</span><span class="o">*</span><span class="n">images_per_row</span> <span class="p">:</span> <span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">images_per_row</span><span class="p">]</span>
        <span class="n">row_images</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">rimages</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">row_images</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span> <span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
    
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">example_images</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">plot_digits</span><span class="p">(</span><span class="n">example_images</span><span class="p">,</span><span class="n">images_per_row</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s">"more_digits_plot"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#æ•°æ®é›†åˆ’åˆ†
#MNISTæ•°æ®é›†çš„è®­ç»ƒé›†å·²ç»è¢«éšæœºæ‰“ä¹±å¹¶åˆ’åˆ†å¥½ï¼Œå‰60000ä¸ªä¸ºè®­ç»ƒé›†ï¼Œå…¶ä½™ä¸ºæµ‹è¯•é›†
</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="mi">60000</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="mi">60000</span><span class="p">:],</span> <span class="n">y</span><span class="p">[:</span><span class="mi">60000</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">60000</span><span class="p">:]</span>

<span class="c1">#è®­ç»ƒä¸€ä¸ªåˆ¤æ–­æ•°å­—æ˜¯å¦ä¸º5çš„äºŒåˆ†ç±»å™¨
#è¿™é‡Œçš„æ ‡ç­¾ä¸ºå¸ƒå°”å‹ï¼Œ5ä¸ºtrueï¼Œé5ä¸ºfalse
</span><span class="n">y_train_5</span> <span class="o">=</span><span class="p">(</span> <span class="n">y_train</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">y_test_5</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_test</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">y_5</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1">#å¼•å…¥SGDåˆ†ç±»å™¨æ¨¡å‹
</span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="c1">#tolä¸ºåœæ­¢æ ‡å‡†ï¼Œå³ç²¾åº¦å°äºtolæ—¶åœæ­¢ï¼Œmax_iter,æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œiterationï¼Œè¿­ä»£
</span><span class="n">sgd_clf</span> <span class="o">=</span> <span class="n">SGDClassifier</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#ä½¿ç”¨è®­ç»ƒé›†è®­ç»ƒæ¨¡å‹
#é€šå¸¸æˆ‘ä»¬æƒ³è¦è®°å½•è®­ç»ƒèŠ±è´¹æ—¶é—´ï¼Œå¼•å…¥timeåŒ…ï¼Œä½¿ç”¨time.time()æ–¹æ³•è®°å½•
</span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sgd_clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_5</span><span class="p">)</span>
<span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"SGDClassifier cost"</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">),</span><span class="s">"s"</span> <span class="p">)</span>

<span class="c1">#è°ƒç”¨æˆ‘ä»¬è®­ç»ƒå¥½çš„æ¨¡å‹æ¥è¯†åˆ«ä¹‹å‰çš„some_digitï¼Œä½¿ç”¨sgd_clf.predict
</span><span class="k">print</span><span class="p">(</span><span class="s">"è®­ç»ƒå®Œæˆçš„æ¨¡å‹åˆ¤æ–­some_digitæ˜¯å¦ä¸º5çš„ç»“è®ºæ˜¯"</span><span class="p">,</span><span class="n">sgd_clf</span><span class="p">.</span><span class="n">predict</span><span class="p">([</span><span class="n">some_digit</span><span class="p">]))</span>

<span class="c1">## åˆ†ç±»æ¨¡å‹è¯„ä»·
#KæŠ˜äº¤å‰éªŒè¯
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="n">scores</span><span class="o">=</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y_5</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s">'accuracy'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"æ¯æŠ˜å‡†ç¡®ç‡ä¸ºï¼š"</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"3æŠ˜äº¤å‰éªŒè¯å¹³å‡å‡†ç¡®ç‡ï¼š"</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>

<span class="c1">#ä¹Ÿå¯ä»¥ä¸ç”¨æ¨¡å‹è‡ªå¸¦çš„cross_val_scoreï¼Œè‡ªå·±å®ç°äº¤å‰éªŒè¯çš„è¿‡ç¨‹
#å¼•å…¥å…‹éš†å™¨ï¼Œç”¨äºå…‹éš†å·²ç»ä½¿ç”¨æŸæŠ˜æ•°æ®è®­ç»ƒè¿‡çš„æ¨¡å‹
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">clone</span>
<span class="c1">#åˆ’åˆ†3æŠ˜,åˆ›å»ºä¸€ä¸ªä¸‰æŠ˜æ•°æ®åˆ’åˆ†å™¨
</span><span class="n">skfolds</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span> <span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#æ¯ä¸€æŠ˜å•ç‹¬åˆ’åˆ†è®­ç»ƒé›†ä¸æµ‹è¯•é›†ï¼Œæ¯æ¬¡è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹è¢«å…‹éš†å¾—åˆ°ä¿å­˜ï¼Œåè¾¹çš„æ•°æ®æŠ˜åœ¨å‰è¾¹è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹åŸºç¡€ä¸Šç»§ç»­è®­ç»ƒ
</span><span class="k">for</span> <span class="n">train_index</span> <span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">skfolds</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_5</span><span class="p">):</span>
    <span class="c1">#kæŠ˜åˆ’åˆ†ç•™ä¸€æŠ˜ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™ä¸ºè®­ç»ƒé›†
</span>    <span class="n">clone_clf</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">)</span>
    <span class="n">X_train_folds</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">y_train_folds</span> <span class="o">=</span> <span class="n">y_train_5</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">X_test_fold</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
    <span class="n">y_test_fold</span> <span class="o">=</span> <span class="n">y_train_5</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
    
    <span class="c1">#ä½¿ç”¨è®­ç»ƒé›†æŠ˜è®­ç»ƒæ¨¡å‹ï¼Œå¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼Œå°†ç»“æœä¸å®é™…æµ‹è¯•é›†targeæ¯”å¯¹ï¼Œå¾—åˆ°æ­£ç¡®æ•°ç›®
</span>    <span class="n">clone_clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_folds</span><span class="p">,</span> <span class="n">y_train_folds</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clone_clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_fold</span><span class="p">)</span>
    <span class="n">n_correct</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">y_test_fold</span><span class="p">)</span>
    <span class="c1">#è®¡ç®—å‡†ç¡®ç‡
</span>    <span class="k">print</span><span class="p">(</span><span class="n">n_correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
    
<span class="c1">#æ··æ·†çŸ©é˜µ
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="c1">#confusion matrix function
</span><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">):</span>
    <span class="n">y_pre</span><span class="o">=</span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">confusion</span><span class="o">=</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pre</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">Oranges</span><span class="p">)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="n">classes</span><span class="p">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">confusion</span><span class="p">))</span>
    <span class="n">iters</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">reshape</span><span class="p">([[[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">],(</span><span class="n">confusion</span><span class="p">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">iters</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">confusion</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>   <span class="c1">#æ˜¾ç¤ºå¯¹åº”çš„æ•°å­—
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Confusion matrix of %s "</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
    <span class="c1"># plt.ylim(len(confusion)-0.5,-0.5)
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'prediction'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'reality'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span><span class="s">'SGDClassifier'</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test_5</span><span class="p">)</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s">"SGDClassifier confusion matrix plot"</span><span class="p">)</span>

<span class="c1"># PR(å‡†ç¡®ç‡/å¬å›ç‡æ›²çº¿)
#å¯¼å…¥PRè®¡ç®—å‡½æ•°ï¼ŒPRæ›²çº¿å‡½æ•°
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>
<span class="c1">#è®¡ç®—è®­ç»ƒé›†çš„PRï¼ŒF1scoreï¼Œè¿™é‡Œä¹Ÿå¯ä»¥è‡ªå·±æ ¹æ®å…¬å¼æ¥è®¡ç®—
</span><span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">sgd_clf</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">sgd_precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">sgd_recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">sgd_f1score</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"P:"</span><span class="p">,</span><span class="n">sgd_precision</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"R:"</span><span class="p">,</span><span class="n">sgd_recall</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"F1:"</span><span class="p">,</span><span class="n">sgd_f1score</span><span class="p">)</span>

<span class="c1">#ä½¿ç”¨cross_val_predictå†³ç­–å‡½æ•°è¿”å›å®ä¾‹çš„é¢„æµ‹åˆ†æ•°ï¼Œè€Œéé¢„æµ‹ç±»åˆ«
#è¯¥å‡½æ•°ä¹Ÿå¯åœ¨ç”Ÿæˆæ··æ·†çŸ©é˜µæ—¶ä½¿ç”¨ï¼Œé‚£ä¸ªæ—¶å€™æ˜¯é¢„æµ‹ç±»åˆ«
</span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span>
<span class="n">y_scores</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">sgd_clf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_5</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="s">"decision_function"</span><span class="p">)</span>
<span class="n">precisions</span><span class="p">,</span> <span class="n">recalls</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>
<span class="c1">#å®šä¹‰PRæ›²çº¿ç»˜åˆ¶å‡½æ•°
</span><span class="k">def</span> <span class="nf">plot_precision_vs_recall</span><span class="p">(</span><span class="n">precisions</span><span class="p">,</span> <span class="n">recalls</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recalls</span><span class="p">,</span> <span class="n">precisions</span><span class="p">,</span> <span class="s">"b-"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Recall"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Precision"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_precision_vs_recall</span><span class="p">(</span><span class="n">precisions</span><span class="p">,</span> <span class="n">recalls</span><span class="p">)</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s">"precision_vs_recall_plot"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#ROC curves å—è¯•è€…å·¥ä½œæ›²çº¿
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span>

<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_roc_curve</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s">'k--'</span><span class="p">)</span> <span class="c1"># dashed diagonal
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'False Positive Rate (Fall-Out)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'True Positive Rate (Recall)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>                

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_roc_curve</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">save_fig</span><span class="p">(</span><span class="s">"roc_curve_plot"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#ä½¿ç”¨aucï¼ˆrocæ›²çº¿ä¸‹æ–¹é¢ç§¯ï¼‰æ‰“åˆ†æ¨¡å‹
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>

<span class="k">print</span><span class="p">(</span><span class="s">"aucå¾—åˆ†ï¼š"</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_train_5</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">))</span>
</code></pre></div></div>

:ET